name: Build and deploy to PyPI
on:
  push:
    branches:
      - fix/cd
jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v2
      - name: Install Twine
        run: |
          pip install twine
          pip install pexpect
      - name: Build and upload manylinux wheel
        env:
          TWINE_USERNAME: ${{ secrets.TWINE_USERNAME}}
          TWINE_PASSWORD: ${{ secrets.TWINE_PASSWORD}}
        run: |
          docker run --rm -v $(pwd):/io quay.io/pypa/manylinux2014_x86_64 bash \
            /io/build-wheels.sh 3.7.17 3.7
          python -m twine upload dist/wheelhouse/*-manylinux*.whl